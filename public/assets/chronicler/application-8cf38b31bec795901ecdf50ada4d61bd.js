/*
 * imgAreaSelect jQuery plugin
 * version 0.9.10
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */
!function(e){function t(){return e("<div/>")}var i=Math.abs,n=Math.max,s=Math.min,o=Math.round;e.imgAreaSelect=function(r,a){function l(e){return e+gt.left-vt.left}function c(e){return e+gt.top-vt.top}function u(e){return e-gt.left+vt.left}function h(e){return e-gt.top+vt.top}function d(e){return e.pageX-vt.left}function p(e){return e.pageY-vt.top}function f(e){var t=e||q,i=e||U;return{x1:o(_t.x1*t),y1:o(_t.y1*i),x2:o(_t.x2*t),y2:o(_t.y2*i),width:o(_t.x2*t)-o(_t.x1*t),height:o(_t.y2*i)-o(_t.y1*i)}}function m(e,t,i,n,s){var r=s||q,a=s||U;_t={x1:o(e/r||0),y1:o(t/a||0),x2:o(i/r||0),y2:o(n/a||0)},_t.width=_t.x2-_t.x1,_t.height=_t.y2-_t.y1}function g(){L&&ut.width()&&(gt={left:o(ut.offset().left),top:o(ut.offset().top)},j=ut.innerWidth(),W=ut.innerHeight(),gt.top+=ut.outerHeight()-W>>1,gt.left+=ut.outerWidth()-j>>1,V=o(a.minWidth/q)||0,K=o(a.minHeight/U)||0,X=o(s(a.maxWidth/q||1<<24,j)),Q=o(s(a.maxHeight/U||1<<24,W)),"1.3.2"!=e().jquery||"fixed"!=bt||xt.getBoundingClientRect||(gt.top+=n(document.body.scrollTop,xt.scrollTop),gt.left+=n(document.body.scrollLeft,xt.scrollLeft)),vt=/absolute|relative/.test(F.css("position"))?{left:o(F.offset().left)-F.scrollLeft(),top:o(F.offset().top)-F.scrollTop()}:"fixed"==bt?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},R=l(0),z=c(0),(_t.x2>j||_t.y2>W)&&k())}function v(t){if(Z){switch(ht.css({left:l(_t.x1),top:c(_t.y1)}).add(dt).width(at=_t.width).height(lt=_t.height),dt.add(pt).add(mt).css({left:0,top:0}),pt.width(n(at-pt.outerWidth()+pt.innerWidth(),0)).height(n(lt-pt.outerHeight()+pt.innerHeight(),0)),e(ft[0]).css({left:R,top:z,width:_t.x1,height:W}),e(ft[1]).css({left:R+_t.x1,top:z,width:at,height:_t.y1}),e(ft[2]).css({left:R+_t.x2,top:z,width:j-_t.x2,height:W}),e(ft[3]).css({left:R+_t.x1,top:z+_t.y2,width:at,height:W-_t.y2}),at-=mt.outerWidth(),lt-=mt.outerHeight(),mt.length){case 8:e(mt[4]).css({left:at>>1}),e(mt[5]).css({left:at,top:lt>>1}),e(mt[6]).css({left:at>>1,top:lt}),e(mt[7]).css({top:lt>>1});case 4:mt.slice(1,3).css({left:at}),mt.slice(2,4).css({top:lt})}t!==!1&&(e.imgAreaSelect.onKeyPress!=Ct&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),a.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=Ct)),kt&&2==pt.outerWidth()-pt.innerWidth()&&(pt.css("margin",0),setTimeout(function(){pt.css("margin","auto")},0))}}function y(e){g(),v(e),J=l(_t.x1),et=c(_t.y1),tt=l(_t.x2),it=c(_t.y2)}function b(e,t){a.fadeSpeed?e.fadeOut(a.fadeSpeed,t):e.hide()}function _(e){var t=u(d(e))-_t.x1,i=h(p(e))-_t.y1;ct||(g(),ct=!0,ht.one("mouseout",function(){ct=!1})),Y="",a.resizable&&(i<=a.resizeMargin?Y="n":i>=_t.height-a.resizeMargin&&(Y="s"),t<=a.resizeMargin?Y+="w":t>=_t.width-a.resizeMargin&&(Y+="e")),ht.css("cursor",Y?Y+"-resize":a.movable?"move":""),O&&O.toggle()}function x(){e("body").css("cursor",""),(a.autoHide||0==_t.width*_t.height)&&b(ht.add(ft),function(){e(this).hide()}),e(document).unbind("mousemove",T),ht.mousemove(_),a.onSelectEnd(r,f())}function w(t){return 1!=t.which?!1:(g(),Y?(e("body").css("cursor",Y+"-resize"),J=l(_t[/w/.test(Y)?"x2":"x1"]),et=c(_t[/n/.test(Y)?"y2":"y1"]),e(document).mousemove(T).one("mouseup",x),ht.unbind("mousemove",_)):a.movable?(B=R+_t.x1-d(t),$=z+_t.y1-p(t),ht.unbind("mousemove",_),e(document).mousemove(D).one("mouseup",function(){a.onSelectEnd(r,f()),e(document).unbind("mousemove",D),ht.mousemove(_)})):ut.mousedown(t),!1)}function C(e){G&&(e?(tt=n(R,s(R+j,J+i(it-et)*G*(tt>J||-1))),it=o(n(z,s(z+W,et+i(tt-J)/G*(it>et||-1)))),tt=o(tt)):(it=n(z,s(z+W,et+i(tt-J)/G*(it>et||-1))),tt=o(n(R,s(R+j,J+i(it-et)*G*(tt>J||-1)))),it=o(it)))}function k(){J=s(J,R+j),et=s(et,z+W),i(tt-J)<V&&(tt=J-V*(J>tt||-1),R>tt?J=R+V:tt>R+j&&(J=R+j-V)),i(it-et)<K&&(it=et-K*(et>it||-1),z>it?et=z+K:it>z+W&&(et=z+W-K)),tt=n(R,s(tt,R+j)),it=n(z,s(it,z+W)),C(i(tt-J)<i(it-et)*G),i(tt-J)>X&&(tt=J-X*(J>tt||-1),C()),i(it-et)>Q&&(it=et-Q*(et>it||-1),C(!0)),_t={x1:u(s(J,tt)),x2:u(n(J,tt)),y1:h(s(et,it)),y2:h(n(et,it)),width:i(tt-J),height:i(it-et)},v(),a.onSelectChange(r,f())}function T(e){return tt=/w|e|^$/.test(Y)||G?d(e):l(_t.x2),it=/n|s|^$/.test(Y)||G?p(e):c(_t.y2),k(),!1}function S(t,i){tt=(J=t)+_t.width,it=(et=i)+_t.height,e.extend(_t,{x1:u(J),y1:h(et),x2:u(tt),y2:h(it)}),v(),a.onSelectChange(r,f())}function D(e){return J=n(R,s(B+d(e),R+j-_t.width)),et=n(z,s($+p(e),z+W-_t.height)),S(J,et),e.preventDefault(),!1}function N(){e(document).unbind("mousemove",N),g(),tt=J,it=et,k(),Y="",ft.is(":visible")||ht.add(ft).hide().fadeIn(a.fadeSpeed||0),Z=!0,e(document).unbind("mouseup",E).mousemove(T).one("mouseup",x),ht.unbind("mousemove",_),a.onSelectStart(r,f())}function E(){e(document).unbind("mousemove",N).unbind("mouseup",E),b(ht.add(ft)),m(u(J),h(et),u(J),h(et)),this instanceof e.imgAreaSelect||(a.onSelectChange(r,f()),a.onSelectEnd(r,f()))}function M(t){return 1!=t.which||ft.is(":animated")?!1:(g(),B=J=d(t),$=et=p(t),e(document).mousemove(N).mouseup(E),!1)}function A(){y(!1)}function I(){L=!0,H(a=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},a)),ht.add(ft).css({visibility:""}),a.show&&(Z=!0,g(),v(),ht.add(ft).hide().fadeIn(a.fadeSpeed||0)),setTimeout(function(){a.onInit(r,f())},0)}function P(e,t){for(var i in t)void 0!==a[i]&&e.css(t[i],a[i])}function H(i){if(i.parent&&(F=e(i.parent)).append(ht.add(ft)),e.extend(a,i),g(),null!=i.handles){for(mt.remove(),mt=e([]),ot=i.handles?"corners"==i.handles?4:8:0;ot--;)mt=mt.add(t());mt.addClass(a.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:yt+1||1}),!parseInt(mt.css("width"))>=0&&mt.width(5).height(5),(rt=a.borderWidth)&&mt.css({borderWidth:rt,borderStyle:"solid"}),P(mt,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(q=a.imageWidth/j||1,U=a.imageHeight/W||1,null!=i.x1&&(m(i.x1,i.y1,i.x2,i.y2),i.show=!i.hide),i.keys&&(a.keys=e.extend({shift:1,ctrl:"resize"},i.keys)),ft.addClass(a.classPrefix+"-outer"),dt.addClass(a.classPrefix+"-selection"),ot=0;ot++<4;)e(pt[ot-1]).addClass(a.classPrefix+"-border"+ot);P(dt,{selectionColor:"background-color",selectionOpacity:"opacity"}),P(pt,{borderOpacity:"opacity",borderWidth:"border-width"}),P(ft,{outerColor:"background-color",outerOpacity:"opacity"}),(rt=a.borderColor1)&&e(pt[0]).css({borderStyle:"solid",borderColor:rt}),(rt=a.borderColor2)&&e(pt[1]).css({borderStyle:"dashed",borderColor:rt}),ht.append(dt.add(pt).add(O)).append(mt),kt&&((rt=(ft.css("filter")||"").match(/opacity=(\d+)/))&&ft.css("opacity",rt[1]/100),(rt=(pt.css("filter")||"").match(/opacity=(\d+)/))&&pt.css("opacity",rt[1]/100)),i.hide?b(ht.add(ft)):i.show&&L&&(Z=!0,ht.add(ft).fadeIn(a.fadeSpeed||0),y()),G=(st=(a.aspectRatio||"").split(/:/))[0]/st[1],ut.add(ft).unbind("mousedown",M),a.disable||a.enable===!1?(ht.unbind("mousemove",_).unbind("mousedown",w),e(window).unbind("resize",A)):((a.enable||a.disable===!1)&&((a.resizable||a.movable)&&ht.mousemove(_).mousedown(w),e(window).resize(A)),a.persistent||ut.add(ft).mousedown(M)),a.enable=a.disable=void 0}var L,O,R,z,j,W,F,B,$,q,U,Y,V,K,X,Q,G,Z,J,et,tt,it,nt,st,ot,rt,at,lt,ct,ut=e(r),ht=t(),dt=t(),pt=t().add(t()).add(t()).add(t()),ft=t().add(t()).add(t()).add(t()),mt=e([]),gt={left:0,top:0},vt={left:0,top:0},yt=0,bt="absolute",_t={x1:0,y1:0,x2:0,y2:0,width:0,height:0},xt=document.documentElement,wt=navigator.userAgent,Ct=function(e){var t,i,o=a.keys,r=e.keyCode;if(t=isNaN(o.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(o.ctrl)&&e.ctrlKey?o.ctrl:!isNaN(o.shift)&&e.shiftKey?o.shift:isNaN(o.arrows)?10:o.arrows:o.alt,"resize"==o.arrows||"resize"==o.shift&&e.shiftKey||"resize"==o.ctrl&&e.ctrlKey||"resize"==o.alt&&(e.altKey||e.originalEvent.altKey)){switch(r){case 37:t=-t;case 39:i=n(J,tt),J=s(J,tt),tt=n(i+t,J),C();break;case 38:t=-t;case 40:i=n(et,it),et=s(et,it),it=n(i+t,et),C(!0);break;default:return}k()}else switch(J=s(J,tt),et=s(et,it),r){case 37:S(n(J-t,R),et);break;case 38:S(J,n(et-t,z));break;case 39:S(J+s(t,j-u(tt)),et);break;case 40:S(J,et+s(t,W-h(it)));break;default:return}return!1};this.remove=function(){H({disable:!0}),ht.add(ft).remove()},this.getOptions=function(){return a},this.setOptions=H,this.getSelection=f,this.setSelection=m,this.cancelSelection=E,this.update=y;var kt=(/msie ([\w.]+)/i.exec(wt)||[])[1],Tt=/opera/i.test(wt),St=/webkit/i.test(wt)&&!/chrome/i.test(wt);for(nt=ut;nt.length;)yt=n(yt,isNaN(nt.css("z-index"))?yt:nt.css("z-index")),"fixed"==nt.css("position")&&(bt="fixed"),nt=nt.parent(":not(body)");yt=a.zIndex||yt,kt&&ut.attr("unselectable","on"),e.imgAreaSelect.keyPress=kt||St?"keydown":"keypress",Tt&&(O=t().css({width:"100%",height:"100%",position:"absolute",zIndex:yt+2||2})),ht.add(ft).css({visibility:"hidden",position:bt,overflow:"hidden",zIndex:yt||"0"}),ht.css({zIndex:yt+2||2}),dt.add(pt).css({position:"absolute",fontSize:0}),r.complete||"complete"==r.readyState||!ut.is("img")?I():ut.one("load",I),!L&&kt&&kt>=7&&(r.src=r.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(void 0===t.enable&&void 0===t.disable&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}}(jQuery),jQuery.fn.farbtastic=function(e){return $.farbtastic(this,e),this},jQuery.farbtastic=function(e,t){var e=$(e).get(0);return e.farbtastic||(e.farbtastic=new jQuery._farbtastic(e,t))},jQuery._farbtastic=function(e,t){var i=this;$(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var n=$(".farbtastic",e);i.wheel=$(".wheel",e).get(0),i.radius=84,i.square=100,i.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",n).each(function(){if("none"!=this.currentStyle.backgroundImage){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}}),i.linkTo=function(e){return"object"==typeof i.callback&&$(i.callback).unbind("keyup",i.updateValue),i.color=null,"function"==typeof e?i.callback=e:("object"==typeof e||"string"==typeof e)&&(i.callback=$(e),i.callback.bind("keyup",i.updateValue),i.callback.get(0).value&&i.setColor(i.callback.get(0).value)),this},i.updateValue=function(){this.value&&this.value!=i.color&&i.setColor(this.value)},i.setColor=function(e){var t=i.unpack(e);return i.color!=e&&t&&(i.color=e,i.rgb=t,i.hsl=i.RGBToHSL(i.rgb),i.updateDisplay()),this},i.setHSL=function(e){return i.hsl=e,i.rgb=i.HSLToRGB(e),i.color=i.pack(i.rgb),i.updateDisplay(),this},i.widgetCoords=function(e){var t,n,s=e.target||e.srcElement,o=i.wheel;if("undefined"!=typeof e.offsetX){for(var r={x:e.offsetX,y:e.offsetY},a=s;a;)a.mouseX=r.x,a.mouseY=r.y,r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;for(var a=o,l={x:0,y:0};a;){if("undefined"!=typeof a.mouseX){t=a.mouseX-l.x,n=a.mouseY-l.y;break}l.x+=a.offsetLeft,l.y+=a.offsetTop,a=a.offsetParent}for(a=s;a;)a.mouseX=void 0,a.mouseY=void 0,a=a.offsetParent}else{var r=i.absolutePosition(o);t=(e.pageX||0*(e.clientX+$("html").get(0).scrollLeft))-r.x,n=(e.pageY||0*(e.clientY+$("html").get(0).scrollTop))-r.y}return{x:t-i.width/2,y:n-i.width/2}},i.mousedown=function(e){document.dragging||($(document).bind("mousemove",i.mousemove).bind("mouseup",i.mouseup),document.dragging=!0);var t=i.widgetCoords(e);return i.circleDrag=2*Math.max(Math.abs(t.x),Math.abs(t.y))>i.square,i.mousemove(e),!1},i.mousemove=function(e){var t=i.widgetCoords(e);if(i.circleDrag){var n=Math.atan2(t.x,-t.y)/6.28;0>n&&(n+=1),i.setHSL([n,i.hsl[1],i.hsl[2]])}else{var s=Math.max(0,Math.min(1,-(t.x/i.square)+.5)),o=Math.max(0,Math.min(1,-(t.y/i.square)+.5));i.setHSL([i.hsl[0],s,o])}return!1},i.mouseup=function(){$(document).unbind("mousemove",i.mousemove),$(document).unbind("mouseup",i.mouseup),document.dragging=!1},i.updateDisplay=function(){var e=6.28*i.hsl[0];$(".h-marker",n).css({left:Math.round(Math.sin(e)*i.radius+i.width/2)+"px",top:Math.round(-Math.cos(e)*i.radius+i.width/2)+"px"}),$(".sl-marker",n).css({left:Math.round(i.square*(.5-i.hsl[1])+i.width/2)+"px",top:Math.round(i.square*(.5-i.hsl[2])+i.width/2)+"px"}),$(".color",n).css("backgroundColor",i.pack(i.HSLToRGB([i.hsl[0],1,.5]))),"object"==typeof i.callback?($(i.callback).css({backgroundColor:i.color,color:i.hsl[2]>.5?"#000":"#fff"}),$(i.callback).each(function(){this.value&&this.value!=i.color&&(this.value=i.color)})):"function"==typeof i.callback&&i.callback.call(i,i.color)},i.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=i.absolutePosition(e.offsetParent);t.x+=n.x,t.y+=n.y}return t},i.pack=function(e){var t=Math.round(255*e[0]),i=Math.round(255*e[1]),n=Math.round(255*e[2]);return"#"+(16>t?"0":"")+t.toString(16)+(16>i?"0":"")+i.toString(16)+(16>n?"0":"")+n.toString(16)},i.unpack=function(e){return 7==e.length?[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]:4==e.length?[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]:void 0},i.HSLToRGB=function(e){var t,i,n=e[0],s=e[1],o=e[2];return i=.5>=o?o*(s+1):o+s-o*s,t=2*o-i,[this.hueToRGB(t,i,n+.33333),this.hueToRGB(t,i,n),this.hueToRGB(t,i,n-.33333)]},i.hueToRGB=function(e,t,i){return i=0>i?i+1:i>1?i-1:i,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(.66666-i):e},i.RGBToHSL=function(e){var t,i,n,s,o,r,a=e[0],l=e[1],c=e[2];return t=Math.min(a,Math.min(l,c)),i=Math.max(a,Math.max(l,c)),n=i-t,r=(t+i)/2,o=0,r>0&&1>r&&(o=n/(.5>r?2*r:2-2*r)),s=0,n>0&&(i==a&&i!=l&&(s+=(l-c)/n),i==l&&i!=c&&(s+=2+(c-a)/n),i==c&&i!=a&&(s+=4+(a-l)/n),s/=6),[s,o,r]},$("*",n).mousedown(i.mousedown),i.setColor("#000000"),t&&i.linkTo(t)};