function updateList(){$("#refresh_button_container").html("<img src='/assets/manticore/tiny_mce/plugins/advimage/img/ajax-loader.gif' />"),$.get("/admin/images.js",function(){$("#refresh_button_container").html("<a id='refresh_button' href='javascript:;' onmousedown='updateList();'>Refresh</a>")})}var ImageDialog={preInit:function(){var e;if(tinyMCEPopup.requireLangPack(),e=tinyMCEPopup.getParam("external_image_list_url")){var t=new Date,i=e+"?"+t.getTime();document.write('<script language="javascript" type="text/javascript" src="'+i+'"></script>')}},init:function(e){var t=document.forms[0],i=t.elements,e=tinyMCEPopup.editor,n=e.dom,s=e.selection.getNode(),o=tinyMCEPopup.getParam("external_image_list","tinyMCEImageList");tinyMCEPopup.resizeToInnerSize(),this.fillClassList("class_list"),this.fillFileList("src_list",o),this.fillFileList("over_list",o),this.fillFileList("out_list",o),TinyMCE_EditableSelects.init(),"IMG"==s.nodeName&&(i.src.value=n.getAttrib(s,"src"),i.width.value=n.getAttrib(s,"width"),i.height.value=n.getAttrib(s,"height"),i.alt.value=n.getAttrib(s,"alt"),i.title.value=n.getAttrib(s,"title"),i.vspace.value=this.getAttrib(s,"vspace"),i.hspace.value=this.getAttrib(s,"hspace"),i.border.value=this.getAttrib(s,"border"),selectByValue(t,"align",this.getAttrib(s,"align")),selectByValue(t,"class_list",n.getAttrib(s,"class"),!0,!0),i.style.value=n.getAttrib(s,"style"),i.id.value=n.getAttrib(s,"id"),i.dir.value=n.getAttrib(s,"dir"),i.lang.value=n.getAttrib(s,"lang"),i.usemap.value=n.getAttrib(s,"usemap"),i.longdesc.value=n.getAttrib(s,"longdesc"),i.insert.value=e.getLang("update"),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(n.getAttrib(s,"onmouseover"))&&(i.onmouseoversrc.value=n.getAttrib(s,"onmouseover").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(n.getAttrib(s,"onmouseout"))&&(i.onmouseoutsrc.value=n.getAttrib(s,"onmouseout").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),e.settings.inline_styles&&(n.getAttrib(s,"align")&&this.updateStyle("align"),n.getAttrib(s,"hspace")&&this.updateStyle("hspace"),n.getAttrib(s,"border")&&this.updateStyle("border"),n.getAttrib(s,"vspace")&&this.updateStyle("vspace"))),document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image"),isVisible("srcbrowser")&&(document.getElementById("src").style.width="260px"),document.getElementById("onmouseoversrccontainer").innerHTML=getBrowserHTML("overbrowser","onmouseoversrc","image","theme_advanced_image"),isVisible("overbrowser")&&(document.getElementById("onmouseoversrc").style.width="260px"),document.getElementById("onmouseoutsrccontainer").innerHTML=getBrowserHTML("outbrowser","onmouseoutsrc","image","theme_advanced_image"),isVisible("outbrowser")&&(document.getElementById("onmouseoutsrc").style.width="260px"),e.getParam("advimage_constrain_proportions",!0)&&(t.constrain.checked=!0),i.onmouseoversrc.value||i.onmouseoutsrc.value?this.setSwapImage(!0):this.setSwapImage(!1),this.changeAppearance(),this.showPreviewImage(i.src.value,1)},insert:function(){var e=tinyMCEPopup.editor,t=this,i=document.forms[0];return""===i.src.value?("IMG"==e.selection.getNode().nodeName&&(e.dom.remove(e.selection.getNode()),e.execCommand("mceRepaint")),tinyMCEPopup.close(),void 0):tinyMCEPopup.getParam("accessibility_warnings",1)&&!i.alt.value?(tinyMCEPopup.confirm(tinyMCEPopup.getLang("advimage_dlg.missing_alt"),function(e){e&&t.insertAndClose()}),void 0):(t.insertAndClose(),void 0)},insertAndClose:function(){var e,t=tinyMCEPopup.editor,i=document.forms[0],n=i.elements,s={};tinyMCEPopup.restoreSelection(),tinymce.isWebKit&&t.getWin().focus(),s=t.settings.inline_styles?{vspace:"",hspace:"",border:"",align:""}:{vspace:n.vspace.value,hspace:n.hspace.value,border:n.border.value,align:getSelectValue(i,"align")},tinymce.extend(s,{src:n.src.value.replace(/ /g,"%20"),width:n.width.value,height:n.height.value,alt:n.alt.value,title:n.title.value,"class":getSelectValue(i,"class_list"),style:n.style.value,id:n.id.value,dir:n.dir.value,lang:n.lang.value,usemap:n.usemap.value,longdesc:n.longdesc.value}),s.onmouseover=s.onmouseout="",i.onmousemovecheck.checked&&(n.onmouseoversrc.value&&(s.onmouseover="this.src='"+n.onmouseoversrc.value+"';"),n.onmouseoutsrc.value&&(s.onmouseout="this.src='"+n.onmouseoutsrc.value+"';")),e=t.selection.getNode(),e&&"IMG"==e.nodeName?t.dom.setAttribs(e,s):(tinymce.each(s,function(e,t){""===e&&delete s[t]}),t.execCommand("mceInsertContent",!1,tinyMCEPopup.editor.dom.createHTML("img",s),{skip_undo:1}),t.undoManager.add()),tinyMCEPopup.editor.execCommand("mceRepaint"),tinyMCEPopup.editor.focus(),tinyMCEPopup.close()},getAttrib:function(e,t){var i,n,s=tinyMCEPopup.editor,o=s.dom;if(s.settings.inline_styles)switch(t){case"align":if(i=o.getStyle(e,"float"))return i;if(i=o.getStyle(e,"vertical-align"))return i;break;case"hspace":if(i=o.getStyle(e,"margin-left"),n=o.getStyle(e,"margin-right"),i&&i==n)return parseInt(i.replace(/[^0-9]/g,""));break;case"vspace":if(i=o.getStyle(e,"margin-top"),n=o.getStyle(e,"margin-bottom"),i&&i==n)return parseInt(i.replace(/[^0-9]/g,""));break;case"border":if(i=0,tinymce.each(["top","right","bottom","left"],function(t){return t=o.getStyle(e,"border-"+t+"-width"),!t||t!=i&&0!==i?(i=0,!1):(t&&(i=t),void 0)}),i)return parseInt(i.replace(/[^0-9]/g,""))}return(i=o.getAttrib(e,t))?i:""},setSwapImage:function(e){var t=document.forms[0];t.onmousemovecheck.checked=e,setBrowserDisabled("overbrowser",!e),setBrowserDisabled("outbrowser",!e),t.over_list&&(t.over_list.disabled=!e),t.out_list&&(t.out_list.disabled=!e),t.onmouseoversrc.disabled=!e,t.onmouseoutsrc.disabled=!e},fillClassList:function(e){var t,i,n=tinyMCEPopup.dom,s=n.get(e);(t=tinyMCEPopup.getParam("theme_advanced_styles"))?(i=[],tinymce.each(t.split(";"),function(e){var t=e.split("=");i.push({title:t[0],"class":t[1]})})):i=tinyMCEPopup.editor.dom.getClasses(),i.length>0?(s.options.length=0,s.options[s.options.length]=new Option(tinyMCEPopup.getLang("not_set"),""),tinymce.each(i,function(e){s.options[s.options.length]=new Option(e.title||e["class"],e["class"])})):n.remove(n.getParent(e,"tr"))},fillFileList:function(e,t){var i=tinyMCEPopup.dom,n=i.get(e);t="function"==typeof t?t():window[t],n.options.length=0,t&&t.length>0&&(n.options[n.options.length]=new Option("",""),tinymce.each(t,function(e){n.options[n.options.length]=new Option(e[0],e[1])}))},resetImageData:function(){var e=document.forms[0];e.elements.width.value=e.elements.height.value=""},updateImageData:function(e,t){var i=document.forms[0];t||(i.elements.width.value=e.width,i.elements.height.value=e.height),this.preloadImg=e},changeAppearance:function(){var e=tinyMCEPopup.editor,t=document.forms[0],i=document.getElementById("alignSampleImg");i&&(e.getParam("inline_styles")?e.dom.setAttrib(i,"style",t.style.value):(i.align=t.align.value,i.border=t.border.value,i.hspace=t.hspace.value,i.vspace=t.vspace.value))},changeHeight:function(){var e,t=document.forms[0],i=this;t.constrain.checked&&i.preloadImg&&""!=t.width.value&&""!=t.height.value&&(e=parseInt(t.width.value)/parseInt(i.preloadImg.width)*i.preloadImg.height,t.height.value=e.toFixed(0))},changeWidth:function(){var e,t=document.forms[0],i=this;t.constrain.checked&&i.preloadImg&&""!=t.width.value&&""!=t.height.value&&(e=parseInt(t.height.value)/parseInt(i.preloadImg.height)*i.preloadImg.width,t.width.value=e.toFixed(0))},updateStyle:function(e){var t,i,n,s,o=tinyMCEPopup.dom,r=tinymce.isIE,a=document.forms[0],l=o.create("img",{style:o.get("style").value});tinyMCEPopup.editor.settings.inline_styles&&("align"==e&&(o.setStyle(l,"float",""),o.setStyle(l,"vertical-align",""),s=getSelectValue(a,"align"),s&&("left"==s||"right"==s?o.setStyle(l,"float",s):l.style.verticalAlign=s)),"border"==e&&(t=l.style.border?l.style.border.split(" "):[],i=o.getStyle(l,"border-style"),n=o.getStyle(l,"border-color"),o.setStyle(l,"border",""),s=a.border.value,(s||"0"==s)&&("0"==s?l.style.border=r?"0":"0 none none":(3==t.length&&t[r?2:1]?i=t[r?2:1]:i&&"none"!=i||(i="solid"),3==t.length&&t[r?0:2]?n=t[r?0:2]:n&&"none"!=n||(n="black"),l.style.border=s+"px "+i+" "+n))),"hspace"==e&&(o.setStyle(l,"marginLeft",""),o.setStyle(l,"marginRight",""),s=a.hspace.value,s&&(l.style.marginLeft=s+"px",l.style.marginRight=s+"px")),"vspace"==e&&(o.setStyle(l,"marginTop",""),o.setStyle(l,"marginBottom",""),s=a.vspace.value,s&&(l.style.marginTop=s+"px",l.style.marginBottom=s+"px")),o.get("style").value=o.serializeStyle(o.parseStyle(l.style.cssText),"img"))},changeMouseMove:function(){},showPreviewImage:function(e,t){return e?(!t&&tinyMCEPopup.getParam("advimage_update_dimensions_onchange",!0)&&this.resetImageData(),e=tinyMCEPopup.editor.documentBaseURI.toAbsolute(e),t?tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+e+'" border="0" onload="ImageDialog.updateImageData(this, 1);" />'):tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+e+'" border="0" onload="ImageDialog.updateImageData(this);" onerror="ImageDialog.resetImageData();" />'),void 0):(tinyMCEPopup.dom.setHTML("prev",""),void 0)}};ImageDialog.preInit(),tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);